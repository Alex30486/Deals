<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@vapi-ai/web@latest/dist/vapi.browser.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&family=JetBrains+Mono&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #050505; color: #fff; }
        .deal-card { background: #0f0f12; border: 1px solid #1a1a1e; transition: all 0.2s ease; }
        .deal-card:hover { border-color: #3b82f6; background: #13131a; }
        .status-pill { font-family: 'JetBrains Mono', monospace; font-size: 10px; padding: 2px 8px; border-radius: 4px; }
    </style>
</head>
<body class="p-8 h-screen flex flex-col overflow-hidden">

    <div class="flex justify-between items-center mb-10 pb-6 border-b border-white/5">
        <div>
            <h1 class="text-2xl font-black italic tracking-tighter">DEALSCOPE <span class="text-blue-500 underline">PRO</span></h1>
            <p class="text-[10px] text-zinc-500 uppercase tracking-widest font-bold mt-1">Status: Ready for Outbound Sequence</p>
        </div>
        <div class="flex gap-4">
            <button onclick="runHeavyLift()" class="bg-zinc-800 hover:bg-zinc-700 px-6 py-2.5 rounded-full text-[11px] font-black uppercase tracking-widest transition-all">
                1. Scrub & Extract
            </button>
            <button onclick="unlockContacts()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2.5 rounded-full text-[11px] font-black uppercase tracking-widest shadow-lg shadow-blue-600/20 transition-all">
                2. Unlock Contacts
            </button>
        </div>
    </div>

    <div class="flex-1 grid grid-cols-1 lg:grid-cols-4 gap-8 overflow-hidden">
        
        <div class="lg:col-span-3 overflow-y-auto pr-4 space-y-4" id="lead-list">
            <div class="h-64 flex flex-col items-center justify-center border-2 border-dashed border-zinc-800 rounded-[2rem] text-zinc-600">
                <p class="text-sm italic">Waiting for CSV Heavy Lift...</p>
            </div>
        </div>

        <div class="flex flex-col gap-6">
            <div class="bg-zinc-900/50 rounded-[2rem] p-6 border border-white/5 flex-1 flex flex-col">
                <h3 class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-6 underline">Execution Log</h3>
                <div id="console" class="flex-1 font-mono text-[10px] text-zinc-500 space-y-2 overflow-y-auto">
                    > System Boot... Ready.
                </div>
            </div>

            <div class="bg-blue-600/10 rounded-[2rem] p-6 border border-blue-500/20">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-[10px] font-black text-blue-500 uppercase">VoIP Bridge</span>
                    <div id="vapi-led" class="w-2 h-2 rounded-full bg-red-500"></div>
                </div>
                <div id="call-meta" class="text-xs font-bold text-zinc-400 mb-4 italic">No Active Call</div>
                <button id="hangup" onclick="endCall()" class="w-full py-3 bg-red-600/20 text-red-500 rounded-xl text-[10px] font-black uppercase hidden">End Call</button>
            </div>
        </div>
    </div>

    <script>
        const vapi = new Vapi('YOUR_VAPI_PUBLIC_KEY');
        const ASSISTANT_ID = 'YOUR_ASSISTANT_ID';

        // 1. DATA EXTRACTION LOGIC
        async function runHeavyLift() {
            const list = document.getElementById('lead-list');
            const log = document.getElementById('console');
            log.innerHTML += `<div class="text-white">> Initializing Python Scrubber Engine...</div>`;
            
            // This pulls from the db.json created by your fast_scrub.py script
            const res = await fetch('db.json');
            const leads = await res.json();
            
            list.innerHTML = leads.map(l => `
                <div class="deal-card p-6 rounded-[2rem] flex items-center justify-between">
                    <div>
                        <div class="flex gap-2 mb-2">
                            <span class="status-pill bg-blue-500/10 text-blue-400">VACANT</span>
                            <span class="status-pill bg-zinc-800 text-zinc-500">${l.z}</span>
                        </div>
                        <h4 class="text-lg font-bold text-white">${l.a}</h4>
                        <p class="text-xs text-zinc-500 font-medium uppercase tracking-wider">${l.o}</p>
                    </div>
                    <button onclick="initiateCall('${l.o}', '${l.a}')" class="bg-white text-black px-8 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-500 hover:text-white transition-all">
                        Quick Call
                    </button>
                </div>
            `).join('');
            log.innerHTML += `<div class="text-green-500">> Successfully loaded ${leads.length} high-rank leads.</div>`;
        }

        // 2. VAPI CALL LOGIC
        function initiateCall(name, address) {
            const meta = document.getElementById('call-meta');
            const led = document.getElementById('vapi-led');
            const hangup = document.getElementById('hangup');
            
            meta.innerHTML = `Calling <span class="text-blue-400">${name}</span>...`;
            led.classList.replace('bg-red-500', 'bg-green-500');
            hangup.classList.remove('hidden');

            vapi.start({
                assistantId: ASSISTANT_ID,
                assistantOverrides: {
                    variableValues: { ownerName: name, propertyAddress: address }
                }
            });

            vapi.on('call-start', () => { meta.innerText = "Connected: AI Agent Speaking"; });
            vapi.on('call-end', () => { 
                meta.innerText = "Call Completed."; 
                led.classList.replace('bg-green-500', 'bg-red-500');
                hangup.classList.add('hidden');
            });
        }

        function endCall() { vapi.stop(); }
    </script>
</body>
</html>
