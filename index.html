<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELARA VAPOR v21</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@vapi-ai/web@latest/dist/vapi.browser.js"></script>
</head>
<body class="bg-[#0a0a0b] text-zinc-100 font-sans antialiased h-screen overflow-hidden flex flex-col">

    <header class="p-6 border-b border-zinc-800/50 flex justify-between items-center bg-[#0a0a0b]">
        <div>
            <h1 class="text-xl font-black tracking-tighter text-blue-500 uppercase">Vapor<span class="text-white">Acquisition</span></h1>
            <div id="status-indicator" class="text-[10px] text-zinc-500 flex items-center gap-2 mt-1 uppercase font-bold">
                <span class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"></span> Offline
            </div>
        </div>
        <button onclick="syncData()" class="bg-white text-black text-xs font-bold px-6 py-2.5 rounded-full hover:bg-zinc-200 transition-all">
            SYNC DATA
        </button>
    </header>

    <div class="flex-1 flex overflow-hidden">
        <main class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
            <div id="lead-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="col-span-full py-20 text-center text-zinc-600 italic border border-dashed border-zinc-800 rounded-2xl">
                    Run the Python scrubber to generate 'db.json'
                </div>
            </div>
        </main>

        <aside class="w-96 border-l border-zinc-800/50 p-6 flex flex-col gap-4 bg-[#0c0c0e]">
            <div class="flex-1 bg-black rounded-2xl p-4 border border-zinc-800/50 overflow-y-auto">
                <h3 class="text-[10px] text-blue-500 font-bold uppercase mb-4 tracking-widest">Agent Logic</h3>
                <div id="agent-logs" class="text-[11px] font-mono text-zinc-500 space-y-1">
                    > Initialize...
                </div>
            </div>

            <div class="bg-blue-600/5 rounded-2xl p-6 border border-blue-500/20">
                <p class="text-[10px] text-blue-400 font-bold uppercase mb-2">Vapi Bridge</p>
                <div id="call-status" class="text-sm italic text-zinc-400">Ready for Outbound.</div>
            </div>
        </aside>
    </div>

    <script>
        // REPLACE WITH YOUR REAL KEYS
        const VAPI_KEY = "YOUR_VAPI_PUBLIC_KEY";
        const ASSISTANT_ID = "YOUR_ASSISTANT_ID";

        let vapiInstance = null;

        // Initialize Vapi Safely
        try {
            vapiInstance = new Vapi(VAPI_KEY);
            document.getElementById('status-indicator').innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-green-500"></span> Bridge Ready';
        } catch (e) {
            console.error("Vapi Init Error", e);
        }

        async function syncData() {
            const container = document.getElementById('lead-container');
            const logs = document.getElementById('agent-logs');
            logs.innerHTML += `<div class="text-white">> Fetching Lead Database...</div>`;

            try {
                const res = await fetch('db.json');
                if (!res.ok) throw new Error("db.json not found");
                const leads = await res.json();
                
                container.innerHTML = leads.map(l => `
                    <div class="bg-zinc-900/50 border border-zinc-800 p-5 rounded-2xl hover:border-blue-500/50 transition-all">
                        <div class="text-[10px] font-bold text-zinc-600 uppercase mb-2">${l.zip}</div>
                        <h4 class="font-bold text-lg text-white truncate">${l.address}</h4>
                        <p class="text-xs text-blue-400 mb-6 uppercase font-bold">${l.owner}</p>
                        <button onclick="startCall('${l.owner}', '${l.address}')" class="w-full bg-blue-600 text-white text-[10px] font-black py-3 rounded-xl uppercase tracking-widest hover:bg-blue-500 transition-all">
                            Initiate Vapi Call
                        </button>
                    </div>
                `).join('');
                logs.innerHTML += `<div class="text-green-500">> ${leads.length} Leads Unlocked.</div>`;
            } catch (err) {
                logs.innerHTML += `<div class="text-red-500">> ERR: ${err.message}</div>`;
            }
        }

        function startCall(name, address) {
            const status = document.getElementById('call-status');
            status.innerHTML = `<span class="text-green-500 font-bold">Calling ${name}...</span>`;
            
            if (!vapiInstance) return;

            vapiInstance.start({
                assistantId: ASSISTANT_ID,
                assistantOverrides: {
                    variableValues: {
                        ownerName: name,
                        propertyAddress: address
                    }
                }
            });

            vapiInstance.on('call-start', () => status.innerText = "Active Call...");
            vapiInstance.on('call-end', () => status.innerText = "Call Finished.");
        }
    </script>
</body>
</html>
